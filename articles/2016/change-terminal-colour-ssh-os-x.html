<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2017-06-07 Wed 16:22 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Change Terminal background colour on OS X via ssh</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Stig Brautaset">
<link rel="stylesheet" type="text/css" href="/css/main.css" />
      <link rel="icon" type="image/png" href="/images/icon.png" />
<script type="text/javascript">
if(/superloopy.io/.test(window.location.hostname)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-4113456-6', 'auto');
  ga('send', 'pageview');
}
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>

<div id="org-div-home-and-up">
  <img src="/images/logo.png" alt="Superloopy Logo"/>
  <nav>
    <ul>
      <!-- <li><a accesskey="h" href="/"> Up </a></li>
 -->
      <li><a accesskey="H" href="/"> Home </a></li>
      <li><a accesskey="a" href="/articles"> Articles </a></li>
      <li><a accesskey="p" href="/publications.html"> Publications </a></li>
      <li><a accesskey="A" href="/about.html"> About </a></li>
    </ul>
  </nav>
</div>
<div id="content">
<h1 class="title">Change Terminal background colour on OS X via ssh</h1>
<div class="abstract">
<p>
I show how to change Terminal.app colours automatically when logging
into certain remote machines via SSH
</p>

</div>
<p>
I spend most of my work days in Emacs, Slack, Safari &amp; Terminal. Some
of the Terminals I've got open, such as those connected to a machine
in the production environment, requires a more elevated attention than
others. It would be nice if these "high risk" terminals were visually
distinct. A colleague shared <a href="http://superuser.com/questions/603909/how-to-change-terminal-colors-when-connecting-to-ssh-hosts">How to change terminal colors change when
connecting to SSH hosts</a> and it inspired me to finally implement this.
</p>

<p>
The solution presented there does not work on OS X Terminal, so I had
to roll my own. My first hurdle was how to change the Terminal
background from a script. The only solution I could find was with
AppleScript. The next issue I had was that the solution given in that
post changes the background for all tabs in that terminal window,
which is not what I want. I can't remember where I found how to affect
only one tab, but here is the code I'm using now:
</p>

<div class="org-src-container">
<pre class="src src-apples"><span style="font-weight: bold;">on</span> <span style="font-weight: bold;">run</span> desiredColour
    <span style="font-weight: bold;">if</span> length <span style="font-weight: bold; font-style: italic;">of</span> desiredColour<span style="font-weight: bold; text-decoration: underline;"> &gt; </span>0
        <span style="font-weight: bold; font-style: italic;">set</span> <span style="font-weight: bold; font-style: italic;">colour</span> <span style="font-weight: bold; font-style: italic;">to</span> desiredColour
    <span style="font-weight: bold;">else</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The RGB colour of the "Novel" profile I'm using;</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This is the default I want to get back to.</span>
        <span style="font-weight: bold; font-style: italic;">set</span> <span style="font-weight: bold; font-style: italic;">colour</span> <span style="font-weight: bold; font-style: italic;">to</span> { 52007, 48990, 29970 }
    <span style="font-weight: bold;">end</span>

   <span style="font-weight: bold;">tell</span> <span style="font-weight: bold;">application</span> <span style="font-style: italic;">"Terminal"</span>
        <span style="font-weight: bold;">tell</span> selected tab <span style="font-weight: bold; font-style: italic;">of</span> <span style="font-weight: bold; font-style: italic;">front</span> window
          <span style="font-weight: bold; font-style: italic;">set</span> background color <span style="font-weight: bold; font-style: italic;">to</span> colour
     <span style="font-weight: bold;">end</span> <span style="font-weight: bold;">tell</span>
  <span style="font-weight: bold;">end</span> <span style="font-weight: bold;">tell</span>
<span style="font-weight: bold;">end</span> <span style="font-weight: bold; font-style: italic;">run</span>
</pre>
</div>

<p>
I put the above in <code>~/Dotfiles/termcolours.scpt</code>, and invoke it from the
commandline like so:
</p>

<div class="org-src-container">
<pre class="src src-sh">osascript ~/Dotfiles/termcolours.scpt red
</pre>
</div>

<p>
That changes the background colour of the current tab to red. (Orange,
yellow, blue, green also works. Try it! Go wild!) Calling the script
with no arguments resets the terminal background back to its default
colour:
</p>

<div class="org-src-container">
<pre class="src src-sh">osascript ~/Dotfiles/termcolours.scpt
</pre>
</div>

<p>
Now, after adding <code>PermitLocalCommand yes</code> to my <code>/etc/ssh/ssh_config</code> I
can put the following in my <code>~/.ssh/config</code>:
</p>

<div class="org-src-container">
<pre class="src src-ssh">Host my-live-machine.example.com
    LocalCommand osascript ~/Dotfiles/termcolours.scpt red
</pre>
</div>

<p>
The current Terminal tab now changes to red when I ssh to that
machine. Result!
</p>

<p>
Ah, but wait! When I exit the remote machine the background of that
tab is not reset to its original colour. For that, if you use Bash/Zsh
you could just use the solution from the post I linked to above. But I
use fish, and it uses functions instead of aliases. I put the
following in <code>~/.config/fish/functions/ssh.fish</code>:
</p>

<div class="org-src-container">
<pre class="src src-fish"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">ssh</span> --description <span style="font-style: italic;">'wrapper around ssh to reset term colours after exit'</span>
        <span style="font-weight: bold;">/usr/bin/ssh</span> <span style="font-style: italic;">$</span><span style="font-weight: bold; font-style: italic;">argv</span>
        <span style="font-weight: bold;">osascript</span> ~/Dotfiles/termcolours.scpt
<span style="font-weight: bold;">end</span>
</pre>
</div>

<p>
And there you have it!
</p>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2016-09-09</p>
<p class="author">Author: Stig Brautaset</p>
<p class="date">Created: 2017-06-07 Wed 16:22</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
