<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Renaming lots of files</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Stig Brautaset">
<link rel="stylesheet" type="text/css" href="/css/main.css" />
<link rel="icon" type="image/png" href="/images/icon.png" />
<script type="text/javascript">
if(/superloopy.io/.test(window.location.hostname)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-4113456-6', 'auto');
  ga('send', 'pageview');
}
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>

<div id="org-div-home-and-up">
  <img src="/images/logo.png" alt="Superloopy Logo"/>
  <nav>
    <ul>
      <!-- <li><a accesskey="h" href="/"> Up </a></li>
 -->
      <li><a accesskey="H" href="/"> Home </a></li>
      <li><a accesskey="p" href="/publications.html"> Publications </a></li>
      <li><a accesskey="A" href="/about.html"> About </a></li>
    </ul>
  </nav>
</div>
<div id="content">
<h1 class="title">Renaming lots of files</h1>
<p>
I was astounded to find out a couple of days ago that one of my
colleagues was not aware of shell parameter expansion. He'd been
confronted with the following problem:
</p>

<blockquote>
<p>
Given a directory full of files, write a shell one-liner to rename all
the ones ending in .doc such that they now end in .txt.
</p>
</blockquote>

<p>
I almost choked on my drink as I heard suggestions involving Perl.
There's no need to complicate things! Here's how to solve the task using
parameter expansion (both Bash and Zsh certainly have these):
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold;">for</span> f<span style="font-weight: bold;"> in</span> *.doc ; <span style="font-weight: bold;">do</span> mv $<span style="font-weight: bold; font-style: italic;">f</span> ${<span style="font-weight: bold; font-style: italic;">f</span>%.doc}.txt ; <span style="font-weight: bold;">done</span>
</pre>
</div>

<p>
Now I know that my previously mentioned colleague won't need the
following explanation (he's already dived into the Bash man page by now,
I suspect), but I'm feeling wordy for a change. Here's the above line
with white space added for readability:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold;">for</span> f<span style="font-weight: bold;"> in</span> *.doc ; <span style="font-weight: bold;">do</span>
    mv $<span style="font-weight: bold; font-style: italic;">f</span> ${<span style="font-weight: bold; font-style: italic;">f</span>%.doc}.txt
<span style="font-weight: bold;">done</span>
</pre>
</div>

<p>
On the first line we use a shell glob (the <code>*</code>) to select all the files
in the current directory that ends in .doc. For each iteration of the
for loop, the variable f contains the name of one of those files. The
third line just says that we're done with the looping, so all the really
interesting bits are happening in the second line.
</p>

<p>
That line says: rename (on Unix a rename is just a move to a new name.
Unix geeks are lazy typists, hence "move" was shortened to "mv") the
file named <code>$f</code> (in shell programming we put a <code>$</code> in front of the
variable name when it can be confused with a literal string) to the
result of the following expression: <code>${f%.doc}.txt</code>. Of that <code>${f%.doc}</code>
is the parameter expansion part. From the zsh man page:
</p>

<blockquote>
<div class="org-src-container">
<pre class="src src-sh">${<span style="font-weight: bold; font-style: italic;">name</span>%pattern}
${<span style="font-weight: bold; font-style: italic;">name</span>%%pattern}
</pre>
</div>

<p>
If the pattern matches the end of the value of name, then substitute
the value of name with the matched portion deleted; otherwise, just
substitute the value of name. In the first form, the smallest matching
pattern is preferred; in the second form, the largest matching pattern
is preferred.
</p>
</blockquote>

<p>
What that means is that if the string in the variable f contains .doc at
the end of it (which we know that it does) strip it off. This will be
the case for all the files, since our for loop only iterates over files
with this ending. The dot over the i is that we simply append .txt.
</p>

<p>
There are <i>loads</i> of other parameter expansion tricks you can do,
including the following, which should feel familiar to Perl people:
<code>${f:gs/foo/bar/}</code>&#x2014;substitute with the content of the variable f, but
with the string "foo" replaced by "bar" everywhere it occurs in f.
</p>

<p>
Enough from me. Dive into the Bash/Zsh man page already!
</p>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2007-06-11</p>
<p class="author">Author: Stig Brautaset</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
